#!/bin/sh

function connect {
	bluetoothctl power on
	bluetoothctl connect "$1"
	notify-send "Bluetooth" "Connected to $2"
}

# State
state=$(bluetoothctl show | grep Powered | cut -d ' ' -f 2)
[ "$state" = "no" ] &&
	cmds="游릭 ON 	bluetoothctl power on	游릭 Powered ON" ||
	cmds="游댮 OFF 	bluetoothctl power off 	游댮 Powered OFF"

# Disconnect
cmds+="
游 Disconnect 	bluetoothctl disconnect 	游 Disconnected"

# Scan
cmds+="
游댍 Scan 	setsid -f bluetoothctl scan on 	游댍 Scanning"

# Devices
devices=$(bluetoothctl devices | cut -d ' ' -f 2-)
readarray -t devices <<< $(echo -e "$devices")
for device in "${devices[@]}"; do
	deviceName=$(echo "$device" | cut -d ' ' -f 2-)
	deviceUID=$(echo "$device" | cut -d ' ' -f 1)
	[ -z "$deviceName" ] && continue
	[ -z "$deviceName" ] && continue
	cmds="$cmds
游닉 $deviceName 	connect $deviceUID $deviceName 	游닉 Connected to $deviceName"
done

choice="$(echo "$cmds" | cut -d'	' -f 1 | dmenu -p "Bluetooth")" || exit 1
`echo "$cmds" | grep "^$choice	" | cut -d '	' -f 2`
notify-send "Bluetooth" "$(echo "$cmds" | grep "^$choice	" | cut -d '	' -f 3)"
